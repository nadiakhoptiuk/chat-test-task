"use strict";(self.webpackChunkchat_test_task=self.webpackChunkchat_test_task||[]).push([[348],{4240:function(e,t,n){n.d(t,{Z:function(){return r}});n(2791);var a="Section_section__Z2PLw",s=n(3329);function r(e){var t=e.title,n=e.isHidden,r=e.width,i=e.flexShrink,o=e.children;return(0,s.jsxs)("section",{className:a,style:{width:"".concat(r),flexShrink:"".concat(i)},children:[(0,s.jsx)("h1",{className:n?"sectionTitleIsHidden":"sectionTitle",children:t}),o]})}},5377:function(e,t,n){n.d(t,{Z:function(){return r}});var a=n(885),s=n(2791);function r(e){var t=(0,s.useState)(e),n=(0,a.Z)(t,2),r=n[0],i=n[1];return{state:r,setState:i,handleChange:function(e){var t=e.target.value;i(t)}}}},2716:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});n(3158);var a=n(8909),s=n(2791),r=n(1405),i="ContactItem_contactItem__Z4FuP",o="ContactItem_selectedBtn__DiKOt ContactItem_contactBtn__nMiN-",c="ContactItem_noneSelectedBtn__oOELV ContactItem_contactBtn__nMiN-",l=n(9914),u="ContactInfoBox_avatarWrapper__Z98dj",d="ContactInfoBox_avatar__5O8YW",f="ContactInfoBox_contactName__+svwH",v="ContactInfoBox_statusIndicatorOnline__n0KjE",_="ContactInfoBox_statusIndicatorOffline__EYWbA",m=n(3329);function h(e){var t=e.id,n=(0,l.W1)(t).data;return n?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:u,children:[(0,m.jsx)("img",{src:null===n||void 0===n?void 0:n.avatar,alt:"".concat(null===n||void 0===n?void 0:n.username," avatar"),className:d}),(0,m.jsx)("div",{className:null!==n&&void 0!==n&&n.isOnline?v:_})]}),(0,m.jsx)("p",{className:f,children:null===n||void 0===n?void 0:n.username})]}):null}var g=function(e){return e.selectedContactId},x=n(9297);function p(e){var t=e.id,n=(0,r.v9)(g),a=(0,r.I0)();var s=JSON.stringify(t)===JSON.stringify(n);return(0,m.jsx)("li",{className:i,children:(0,m.jsx)("button",{type:"button",onClick:function(){return a((0,x.f)(t))},className:s?o:c,children:(0,m.jsx)(h,{id:t})})})}var j=function(e){return e.filter},M="ContactsList_contactsList__ZQI1L",y=n(1038),C="FilterInput_inputLabel__C+sAF",w="FilterInput_filterInput__LNZay";function I(){var e=(0,l.wY)("",{refetchOnFocus:!0,refetchOnReconnect:!0}).data,t=(0,r.v9)(j),n=(0,r.I0)();return(0,m.jsx)(m.Fragment,{children:(null===e||void 0===e?void 0:e.length)>0?(0,m.jsx)("label",{className:C,children:(0,m.jsx)("input",{className:w,type:"text",name:"filter",value:t,onChange:function(e){var t=e.target.value;n((0,y.a)(t))},placeholder:"Search or start new chat"})}):null})}var N=n(4240);function S(){var e=(0,l.wY)().data,t=(0,r.v9)(j),n=function(){var n=null===t||void 0===t?void 0:t.toLowerCase();return t?null===e||void 0===e?void 0:e.filter((function(e){return e.username.toLowerCase().includes(n)})):e}();return(0,m.jsxs)(N.Z,{title:"Chats",isHidden:!1,width:"300px",flexShrink:0,children:[(0,m.jsx)(I,{}),(0,m.jsx)("ul",{className:M,children:n?null===n||void 0===n?void 0:n.map((function(e){return(0,m.jsx)(p,{id:e.id},e.id)})):null})]})}var Z=n(2982),O=n(885),H=n(1413),L=n(5861),k=n(7757),F=n.n(k),b=n(4358),B=n(5377),D="FormSendMessage_formWrapper__pP-FY",T="FormSendMessage_form__qHlW2",R="FormSendMessage_input__hlTCO",E="FormSendMessage_formBtn__R-YUO",W="FormSendMessage_btnIcon__qVR2i",Y=n(4569),A=n.n(Y);function P(e){var t=e.id,n=e.setMessageList,a=e.data,r=e.messageList,i=(0,B.Z)(""),o=i.state,c=i.setState,u=i.handleChange,d=(0,l.Ar)(),f=(0,O.Z)(d,1)[0],v=(0,s.useCallback)(function(){var e=(0,L.Z)(F().mark((function e(s,r){var i,o;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={message:s,date:(new Date).toISOString(),isSendedByMe:r},o=[].concat((0,Z.Z)(null===a||void 0===a?void 0:a.messages),[i]).sort((function(e,t){return new Date(e.date)-new Date(t.date)})),e.next=4,n(o);case 4:return e.next=6,f({id:t,contact:(0,H.Z)((0,H.Z)({},a),{},{messages:o})});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[f,a,t,n]),_=function(){var e=(0,L.Z)(F().mark((function e(t){return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),v(o,!0),c("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){if(r){var e=(new Date).getTime(),t=r[(null===r||void 0===r?void 0:r.length)-1],n=new Date(null===t||void 0===t?void 0:t.date).getTime();if(null!==t&&void 0!==t&&t.isSendedByMe&&!(e-n>1e4)){var a=setTimeout((function(){A()({method:"get",url:"https://api.chucknorris.io/jokes/random"}).then((function(e){return e.data.value})).then((function(e){v(e,!1)})).catch((function(e){console.log(e)}))}),1e4);return function(){console.log("cleared"),clearTimeout(a)}}}}),[r]),(0,m.jsx)("div",{className:D,children:(0,m.jsxs)("form",{className:T,onSubmit:_,children:[(0,m.jsx)("input",{type:"text",name:"message",className:R,placeholder:"Type your message...",value:o,onChange:u}),(0,m.jsx)("button",{type:"submit",className:E,children:(0,m.jsx)(b.b_K,{className:W})})]})})}var J=n(8977),q="MessageHistory_messageList__a9+dD",K="MessageHistory_myMessage__HM7bD MessageHistory_message__5aRvm",V="MessageHistory_interlocutorMessage__7+L5R MessageHistory_message__5aRvm",Q="MessageHistory_myMessageText__RnlJ9 MessageHistory_messageText__TJe4M",U="MessageHistory_interlocutorMessageText__7j-Pq MessageHistory_messageText__TJe4M",z="MessageHistory_messageDate__lZ3A9";function G(e){var t=e.id,n=e.messageListRef,a=(0,s.useState)(null===n||void 0===n?void 0:n.current),r=(0,O.Z)(a,2),i=r[0],o=r[1],c=(0,l.W1)(t,{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}).data;return(0,s.useEffect)((function(){var e;if(null!==(null===(e=document)||void 0===e?void 0:e.getElementById("chat"))){var t;(t=document.getElementById("chat")).scroll({top:t.scrollHeight,behavior:"smooth"})}}),[t,i]),(0,s.useEffect)((function(){if(c&&0!==(null===c||void 0===c?void 0:c.length)){var e=(0,Z.Z)(null===c||void 0===c?void 0:c.messages).sort((function(e,t){return new Date(e.date)-new Date(t.date)}));o(e)}}),[c,o]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("ul",{className:q,id:"chat",children:i?null===i||void 0===i?void 0:i.map((function(e,t){var n=e.message,a=e.isSendedByMe,s=e.date,r=(0,J.Z)(new Date(s),"PP, p");return(0,m.jsxs)("li",{className:a?K:V,children:[(0,m.jsx)("p",{className:a?Q:U,children:n}),(0,m.jsx)("span",{className:z,children:r})]},t)})):null}),(0,m.jsx)(P,{id:t,setMessageList:o,data:c,messageList:i})]})}function X(e){var t=e.id,n=(0,l.W1)(t).data;(0,s.useEffect)((function(){var e;if(n&&0!==(null===n||void 0===n||null===(e=n.messages)||void 0===e?void 0:e.length)){var t,s=(t=null===n||void 0===n?void 0:n.messages,(0,Z.Z)(t).sort((function(e,t){return new Date(e.date)-new Date(t.date)})));a.current=s}}),[n]);var a=(0,s.useRef)(null);return(0,m.jsxs)(N.Z,{title:"Chat",isHidden:!0,width:"100%",flexShrink:1,children:[(0,m.jsx)(h,{id:t}),(0,m.jsx)(G,{id:t,messageListRef:a.current})]})}function $(){var e=(0,r.I0)(),t=(0,r.v9)((function(e){return e.selectedContactId})),n=(0,l.wY)("",{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}),i=n.data,o=n.isFetching;return(0,s.useEffect)((function(){i&&(o||null!==t||e((0,x.f)(i[0].id)))}),[i,e,o,t]),(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(a.Z,{children:[(0,m.jsx)(S,{}),(0,m.jsx)(X,{id:t})]})})}}}]);
//# sourceMappingURL=chat.00a5c69a.chunk.js.map