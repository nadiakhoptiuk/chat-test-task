"use strict";(self.webpackChunkchat_test_task=self.webpackChunkchat_test_task||[]).push([[348],{4240:function(e,t,n){n.d(t,{Z:function(){return r}});n(2791);var s="Section_section__Z2PLw",a=n(3329);function r(e){var t=e.title,n=e.isHidden,r=e.width,i=e.flexShrink,o=e.children;return(0,a.jsxs)("section",{className:s,style:{width:"".concat(r),flexShrink:"".concat(i)},children:[(0,a.jsx)("h1",{className:n?"sectionTitleIsHidden":"sectionTitle",children:t}),o]})}},5377:function(e,t,n){n.d(t,{Z:function(){return r}});var s=n(885),a=n(2791);function r(e){var t=(0,a.useState)(e),n=(0,s.Z)(t,2),r=n[0],i=n[1];return{state:r,setState:i,handleChange:function(e){var t=e.target.value;i(t)}}}},2716:function(e,t,n){n.r(t),n.d(t,{default:function(){return ee}});n(3158);var s=n(2791),a=n(1405),r=n(9297),i=n(9914),o=n(8909),c=function(e){return e.filter},l=function(e){return e.selectedContactId},u="ContactInfoBox_contactInfoWrapper__av+tf",d="ContactInfoBox_avatarWrapper__Z98dj",f="ContactInfoBox_avatar__5O8YW",v="ContactInfoBox_contactName__+svwH",_="ContactInfoBox_statusIndicatorOnline__n0KjE",m="ContactInfoBox_statusIndicatorOffline__EYWbA",h=n(3329);function g(e){var t=e.id,n=(0,i.W1)(t).data;return n?(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{className:u,children:[(0,h.jsxs)("div",{className:d,children:[(0,h.jsx)("img",{src:null===n||void 0===n?void 0:n.avatar,alt:"".concat(null===n||void 0===n?void 0:n.username," avatar"),className:f}),(0,h.jsx)("div",{className:null!==n&&void 0!==n&&n.isOnline?_:m})]}),(0,h.jsx)("p",{className:v,children:null===n||void 0===n?void 0:n.username})]})}):null}var x="ContactItem_contactItem__Z4FuP",p="ContactItem_selectedBtn__DiKOt ContactItem_contactBtn__nMiN-",j="ContactItem_noneSelectedBtn__oOELV ContactItem_contactBtn__nMiN-";function y(e){var t=e.id,n=(0,a.v9)(l),s=(0,a.I0)();var i=JSON.stringify(t)===JSON.stringify(n);return(0,h.jsx)("li",{className:x,children:(0,h.jsx)("button",{type:"button",onClick:function(){return s((0,r.f)(t))},className:i?p:j,children:(0,h.jsx)(g,{id:t})})})}var M=n(1038),C="FilterInput_inputLabel__C+sAF",I="FilterInput_filterInput__LNZay";function w(){var e=(0,i.wY)("",{refetchOnFocus:!0,refetchOnReconnect:!0}).data,t=(0,a.v9)(c),n=(0,a.I0)();return(0,h.jsx)(h.Fragment,{children:(null===e||void 0===e?void 0:e.length)>0?(0,h.jsx)("label",{className:C,children:(0,h.jsx)("input",{className:I,type:"text",name:"filter",value:t,onChange:function(e){var t=e.target.value;n((0,M.a)(t))},placeholder:"Search or start new chat"})}):null})}var N=n(4240),S="ContactsList_contactsList__ZQI1L";function Z(){var e=(0,i.wY)().data,t=(0,a.v9)(c),n=function(){var n=null===t||void 0===t?void 0:t.toLowerCase();return t?null===e||void 0===e?void 0:e.filter((function(e){return e.username.toLowerCase().includes(n)})):e}();return(0,h.jsxs)(N.Z,{title:"Chats",isHidden:!1,width:window.innerWidth<768?"150px":"300px",flexShrink:0,children:[(0,h.jsx)(w,{}),(0,h.jsx)("ul",{className:S,children:n?null===n||void 0===n?void 0:n.map((function(e){return(0,h.jsx)(y,{id:e.id},e.id)})):null})]})}var O=n(2982),H=n(885),L=n(8977),k=n(1413),B=n(5861),F=n(7757),b=n.n(F),T=n(4569),D=n.n(T);var R=n(4358),E=n(5377),W="FormSendMessage_formWrapper__pP-FY",Y="FormSendMessage_form__qHlW2",A="FormSendMessage_input__hlTCO",P="FormSendMessage_formBtn__R-YUO",J="FormSendMessage_btnIcon__qVR2i";function q(e){var t=e.id,n=e.setMessageList,a=e.data,r=e.messageList,o=(0,E.Z)(""),c=o.state,l=o.setState,u=o.handleChange,d=(0,i.Ar)(),f=(0,H.Z)(d,1)[0],v=(0,s.useCallback)(function(){var e=(0,B.Z)(b().mark((function e(s,r){var i,o;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={message:s,date:(new Date).toISOString(),isSendedByMe:r},o=[].concat((0,O.Z)(null===a||void 0===a?void 0:a.messages),[i]).sort((function(e,t){return new Date(e.date)-new Date(t.date)})),e.next=4,n(o);case 4:return e.next=6,f({id:t,contact:(0,k.Z)((0,k.Z)({},a),{},{messages:o})});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[f,a,t,n]),_=function(){var e=(0,B.Z)(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),v(c,!0),l("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){if(r){var e=(new Date).getTime(),t=r[(null===r||void 0===r?void 0:r.length)-1],n=new Date(null===t||void 0===t?void 0:t.date).getTime();if(null!==t&&void 0!==t&&t.isSendedByMe&&!(e-n>1e4)){var s=setTimeout((function(){D()({method:"get",url:"https://api.chucknorris.io/jokes/random"}).then((function(e){return e.data.value})).then((function(e){v(e,!1)})).catch((function(e){console.log(e)}))}),1e4);return function(){clearTimeout(s)}}}}),[r]),(0,h.jsx)("div",{className:W,children:(0,h.jsxs)("form",{className:Y,onSubmit:_,children:[(0,h.jsx)("input",{type:"text",name:"message",className:A,placeholder:"Type your message...",value:c,onChange:u}),(0,h.jsx)("button",{type:"submit",className:P,children:(0,h.jsx)(R.b_K,{className:J})})]})})}var K="MessageHistory_messageList__a9+dD",V="MessageHistory_myMessage__HM7bD MessageHistory_message__5aRvm",Q="MessageHistory_interlocutorMessage__7+L5R MessageHistory_message__5aRvm",U="MessageHistory_myMessageText__RnlJ9 MessageHistory_messageText__TJe4M",z="MessageHistory_interlocutorMessageText__7j-Pq MessageHistory_messageText__TJe4M",G="MessageHistory_messageDate__lZ3A9";function X(e){var t=e.id,n=e.messageListRef,a=(0,s.useState)(null===n||void 0===n?void 0:n.current),r=(0,H.Z)(a,2),o=r[0],c=r[1],l=(0,i.W1)(t,{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}).data;return(0,s.useEffect)((function(){var e;if(null!==(null===(e=document)||void 0===e?void 0:e.getElementById("chat"))){var t;(t=document.getElementById("chat")).scroll({top:t.scrollHeight,behavior:"smooth"})}}),[t,o]),(0,s.useEffect)((function(){l&&0!==(null===l||void 0===l?void 0:l.length)&&c(null===l||void 0===l?void 0:l.messages)}),[l,c]),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("ul",{className:K,id:"chat",children:o?null===o||void 0===o?void 0:o.map((function(e,t){var n=e.message,s=e.isSendedByMe,a=e.date,r=(0,L.Z)(new Date(a),"PP, p");return(0,h.jsxs)("li",{className:s?V:Q,children:[(0,h.jsx)("p",{className:s?U:z,children:n}),(0,h.jsx)("span",{className:G,children:r})]},t)})):null}),(0,h.jsx)(q,{id:t,setMessageList:c,data:l,messageList:o})]})}function $(e){var t=e.id,n=(0,i.W1)(t).data;(0,s.useEffect)((function(){var e;if(n&&0!==(null===n||void 0===n||null===(e=n.messages)||void 0===e?void 0:e.length)){var t,s=(t=null===n||void 0===n?void 0:n.messages,(0,O.Z)(t).sort((function(e,t){return new Date(e.date)-new Date(t.date)})));a.current=s}}),[n]);var a=(0,s.useRef)(null);return(0,h.jsxs)(N.Z,{title:"Chat",isHidden:!0,width:"100%",flexShrink:1,children:[(0,h.jsx)(g,{id:t}),(0,h.jsx)(X,{id:t,messageListRef:a.current})]})}function ee(){var e=(0,a.I0)(),t=(0,a.v9)((function(e){return e.selectedContactId})),n=(0,i.wY)("",{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}),c=n.data,l=n.isFetching;return(0,s.useEffect)((function(){c&&(l||null!==t||e((0,r.f)(c[0].id)))}),[c,e,l,t]),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(o.Z,{style:{display:"flex"},children:[(0,h.jsx)(Z,{}),(0,h.jsx)($,{id:t})]})})}}}]);
//# sourceMappingURL=chat.2eb88dc8.chunk.js.map