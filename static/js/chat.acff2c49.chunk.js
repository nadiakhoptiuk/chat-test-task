"use strict";(self.webpackChunkchat_test_task=self.webpackChunkchat_test_task||[]).push([[348],{4240:function(e,t,n){n.d(t,{Z:function(){return i}});n(2791);var s="Section_section__Z2PLw",a=n(3329);function i(e){var t=e.title,n=e.isHidden,i=e.width,r=e.flexShrink,o=e.children;return(0,a.jsxs)("section",{className:s,style:{width:"".concat(i),flexShrink:"".concat(r)},children:[(0,a.jsx)("h1",{className:n?"sectionTitleIsHidden":"sectionTitle",children:t}),o]})}},5377:function(e,t,n){n.d(t,{Z:function(){return i}});var s=n(885),a=n(2791);function i(e){var t=(0,a.useState)(e),n=(0,s.Z)(t,2),i=n[0],r=n[1];return{state:i,setState:r,handleChange:function(e){var t=e.target.value;r(t)}}}},2716:function(e,t,n){n.r(t),n.d(t,{default:function(){return ee}});n(3158);var s=n(8909),a=n(2791),i=n(1405),r="ContactItem_contactItem__Z4FuP",o="ContactItem_selectedBtn__DiKOt ContactItem_contactBtn__nMiN-",c="ContactItem_noneSelectedBtn__oOELV ContactItem_contactBtn__nMiN-",l=n(9914),u="ContactInfoBox_contactInfoWrapper__av+tf",d="ContactInfoBox_avatarWrapper__Z98dj",f="ContactInfoBox_avatar__5O8YW",v="ContactInfoBox_contactName__+svwH",_="ContactInfoBox_statusIndicatorOnline__n0KjE",m="ContactInfoBox_statusIndicatorOffline__EYWbA",h=n(3329);function g(e){var t=e.id,n=(0,l.W1)(t).data;return n?(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)("div",{className:u,children:[(0,h.jsxs)("div",{className:d,children:[(0,h.jsx)("img",{src:null===n||void 0===n?void 0:n.avatar,alt:"".concat(null===n||void 0===n?void 0:n.username," avatar"),className:f}),(0,h.jsx)("div",{className:null!==n&&void 0!==n&&n.isOnline?_:m})]}),(0,h.jsx)("p",{className:v,children:null===n||void 0===n?void 0:n.username})]})}):null}var x=function(e){return e.selectedContactId},p=n(9297);function j(e){var t=e.id,n=(0,i.v9)(x),s=(0,i.I0)();var a=JSON.stringify(t)===JSON.stringify(n);return(0,h.jsx)("li",{className:r,children:(0,h.jsx)("button",{type:"button",onClick:function(){return s((0,p.f)(t))},className:a?o:c,children:(0,h.jsx)(g,{id:t})})})}var M=function(e){return e.filter},w="ContactsList_contactsList__ZQI1L",C=n(1038),y="FilterInput_inputLabel__C+sAF",I="FilterInput_filterInput__LNZay";function N(){var e=(0,l.wY)("",{refetchOnFocus:!0,refetchOnReconnect:!0}).data,t=(0,i.v9)(M),n=(0,i.I0)();return(0,h.jsx)(h.Fragment,{children:(null===e||void 0===e?void 0:e.length)>0?(0,h.jsx)("label",{className:y,children:(0,h.jsx)("input",{className:I,type:"text",name:"filter",value:t,onChange:function(e){var t=e.target.value;n((0,C.a)(t))},placeholder:"Search or start new chat"})}):null})}var S=n(4240);function Z(){var e=(0,l.wY)().data,t=(0,i.v9)(M),n=function(){var n=null===t||void 0===t?void 0:t.toLowerCase();return t?null===e||void 0===e?void 0:e.filter((function(e){return e.username.toLowerCase().includes(n)})):e}();return(0,h.jsxs)(S.Z,{title:"Chats",isHidden:!1,width:window.innerWidth<768?"200px":"300px",flexShrink:0,children:[(0,h.jsx)(N,{}),(0,h.jsx)("ul",{className:w,children:n?null===n||void 0===n?void 0:n.map((function(e){return(0,h.jsx)(j,{id:e.id},e.id)})):null})]})}var O=n(2982),H=n(885),L=n(1413),k=n(5861),B=n(7757),F=n.n(B),b=n(4358),T=n(5377),D="FormSendMessage_formWrapper__pP-FY",R="FormSendMessage_form__qHlW2",W="FormSendMessage_input__hlTCO",E="FormSendMessage_formBtn__R-YUO",Y="FormSendMessage_btnIcon__qVR2i",A=n(4569),P=n.n(A);function J(e){var t=e.id,n=e.setMessageList,s=e.data,i=e.messageList,r=(0,T.Z)(""),o=r.state,c=r.setState,u=r.handleChange,d=(0,l.Ar)(),f=(0,H.Z)(d,1)[0],v=(0,a.useCallback)(function(){var e=(0,k.Z)(F().mark((function e(a,i){var r,o;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={message:a,date:(new Date).toISOString(),isSendedByMe:i},o=[].concat((0,O.Z)(null===s||void 0===s?void 0:s.messages),[r]).sort((function(e,t){return new Date(e.date)-new Date(t.date)})),e.next=4,n(o);case 4:return e.next=6,f({id:t,contact:(0,L.Z)((0,L.Z)({},s),{},{messages:o})});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[f,s,t,n]),_=function(){var e=(0,k.Z)(F().mark((function e(t){return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),v(o,!0),c("");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){if(i){var e=(new Date).getTime(),t=i[(null===i||void 0===i?void 0:i.length)-1],n=new Date(null===t||void 0===t?void 0:t.date).getTime();if(null!==t&&void 0!==t&&t.isSendedByMe&&!(e-n>1e4)){var s=setTimeout((function(){P()({method:"get",url:"https://api.chucknorris.io/jokes/random"}).then((function(e){return e.data.value})).then((function(e){v(e,!1)})).catch((function(e){console.log(e)}))}),1e4);return function(){clearTimeout(s)}}}}),[i]),(0,h.jsx)("div",{className:D,children:(0,h.jsxs)("form",{className:R,onSubmit:_,children:[(0,h.jsx)("input",{type:"text",name:"message",className:W,placeholder:"Type your message...",value:o,onChange:u}),(0,h.jsx)("button",{type:"submit",className:E,children:(0,h.jsx)(b.b_K,{className:Y})})]})})}var q=n(8977),K="MessageHistory_messageList__a9+dD",V="MessageHistory_myMessage__HM7bD MessageHistory_message__5aRvm",Q="MessageHistory_interlocutorMessage__7+L5R MessageHistory_message__5aRvm",U="MessageHistory_myMessageText__RnlJ9 MessageHistory_messageText__TJe4M",z="MessageHistory_interlocutorMessageText__7j-Pq MessageHistory_messageText__TJe4M",G="MessageHistory_messageDate__lZ3A9";function X(e){var t=e.id,n=e.messageListRef,s=(0,a.useState)(null===n||void 0===n?void 0:n.current),i=(0,H.Z)(s,2),r=i[0],o=i[1],c=(0,l.W1)(t,{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}).data;return(0,a.useEffect)((function(){var e;if(null!==(null===(e=document)||void 0===e?void 0:e.getElementById("chat"))){var t;(t=document.getElementById("chat")).scroll({top:t.scrollHeight,behavior:"smooth"})}}),[t,r]),(0,a.useEffect)((function(){c&&0!==(null===c||void 0===c?void 0:c.length)&&o(null===c||void 0===c?void 0:c.messages)}),[c,o]),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("ul",{className:K,id:"chat",children:r?null===r||void 0===r?void 0:r.map((function(e,t){var n=e.message,s=e.isSendedByMe,a=e.date,i=(0,q.Z)(new Date(a),"PP, p");return(0,h.jsxs)("li",{className:s?V:Q,children:[(0,h.jsx)("p",{className:s?U:z,children:n}),(0,h.jsx)("span",{className:G,children:i})]},t)})):null}),(0,h.jsx)(J,{id:t,setMessageList:o,data:c,messageList:r})]})}function $(e){var t=e.id,n=(0,l.W1)(t).data;(0,a.useEffect)((function(){var e;if(n&&0!==(null===n||void 0===n||null===(e=n.messages)||void 0===e?void 0:e.length)){var t,a=(t=null===n||void 0===n?void 0:n.messages,(0,O.Z)(t).sort((function(e,t){return new Date(e.date)-new Date(t.date)})));s.current=a}}),[n]);var s=(0,a.useRef)(null);return(0,h.jsxs)(S.Z,{title:"Chat",isHidden:!0,width:"100%",flexShrink:1,children:[(0,h.jsx)(g,{id:t}),(0,h.jsx)(X,{id:t,messageListRef:s.current})]})}function ee(){var e=(0,i.I0)(),t=(0,i.v9)((function(e){return e.selectedContactId})),n=(0,l.wY)("",{refetchOnReconnect:!0,refetchOnMountOrArgChange:!0}),r=n.data,o=n.isFetching;return(0,a.useEffect)((function(){r&&(o||null!==t||e((0,p.f)(r[0].id)))}),[r,e,o,t]),console.log(window.innerWidth),(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(s.Z,{children:[(0,h.jsx)(Z,{}),(0,h.jsx)($,{id:t})]})})}}}]);
//# sourceMappingURL=chat.acff2c49.chunk.js.map